# Monitoring Deployment Solutions Report

## 문제 요약 및 원인 분석

- **AI 모델 수 불일치**: 모니터링 페이지에서 표시되는 모델 수가 실제 운영 환경과 달라 일부 모델이 누락되는 문제가 확인되었다. 이는 모델 기본 정보와 상태 정보(시계열 테이블) 간의 동기화 부족 때문이며 새 모델을 추가할 때 상태 레코드를 초기화하지 않은 것이 원인이다.
- **Operational 상태 하드코딩**: 상태 필드가 기본값으로 `operational`로 설정되어 모니터링 UI에 항상 정상으로 표시되었다. 건강 체크나 상태 업데이트 로직이 구현되지 않은 상황에서 기본값이 실제 장애 상황을 덮어버렸다.
- **Vercel 환경에서 SQLite 사용**: 서버리스 배포 환경(Vercel)에서 로컬 SQLite DB를 사용해 데이터가 함수 인스턴스 간 공유되지 못하고 배포마다 초기화되었다【24†L153-L160】. 이는 지속성을 보장하지 못해 모니터링 데이터가 유실되는 원인으로 작용했다.
- **데이터 소스의 다중성**: 모니터링 데이터가 복수의 소스(로컬 파일, API, 캐시, 다국어용 SSR 빌드 결과)에서 조합되어 일관성이 떨어졌다. 특히 페이지마다 SSR/SSG된 데이터가 캐시되어 최신 정보와 맞지 않았다.
- **폴링 기반 갱신**: 실시간 스트리밍 구현이 비활성화되고 폴링에 의존해 서버 부하 증가와 업데이트 지연이 발생했다【22†L144-L149】.

## 해결 방안

### 즉시 조치 (24시간 이내)

1. **운영 DB로 전환**: 모든 모니터링 API가 SQLite 대신 PostgreSQL 운영 DB를 사용하도록 환경변수를 수정하고 Prisma 설정을 업데이트한다【24†L153-L160】. 서버리스 환경에서도 클라우드 DB를 통해 데이터를 공유할 수 있다.
2. **모델-상태 초기화 로직 추가**: 새 모델 등록 시 상태 테이블에 기본 상태(`unknown`)를 생성하여 모델 수가 누락되지 않도록 한다. 기존 데이터에 대해서도 누락된 상태 레코드를 일괄 생성한다.
3. **Operational 기본값 제거**: 프론트엔드에서 `operational` 상태를 기본 표시하지 않고, 실제 상태값이 없으면 `Unknown`이나 `—`를 표시하여 오경보를 방지한다.
4. **SSR/SSG 비활성화**: 모니터링 페이지를 클라이언트 사이드 렌더링(CSR)으로 전환하여 초기 로딩 시 최신 데이터를 직접 fetch하게 한다. SSR 캐시로 인한 데이터 불일치를 없앤다.

### 단기 계획 (1–2주)

1. **TimescaleDB 확장**: 운영 DB에 TimescaleDB를 적용하고 필요한 읽기 복제본을 생성해 시계열 데이터 처리와 지역별 읽기 부하 분산을 준비한다.
2. **SSE 도입**: 폴링을 대체할 Server-Sent Events(SSE) 기반 실시간 스트리밍 엔드포인트를 구현한다. Vercel 환경에서도 단방향 스트리밍이 가능하므로 실시간성을 개선할 수 있다.
3. **다국어 데이터 공유 개선**: 모니터링 데이터는 언어에 관계없이 동일하므로, 글로벌 컨텍스트나 전역 캐시를 활용해 한 번만 데이터를 요청하고 locale 페이지에서 공유하도록 한다.
4. **알림 시스템 구축**: 상태 변화나 장애 발생 시 Slack/Webhook을 통해 즉각 알림을 받을 수 있도록 백엔드에서 알림 모듈을 추가한다.

### 중기 계획 (1–3개월)

1. **글로벌 Read Replica 배포**: 북미, 유럽, 아시아 등 지역별로 PostgreSQL 읽기 복제본을 구축해 지리적 지연을 줄이고 장애 시 다른 리전으로 폴백한다.
2. **헬스체크 수집 서비스 개발**: 각 모델의 API를 주기적으로 검사하여 상태를 업데이트하는 백엔드 수집기를 개발하고 TimescaleDB에 기록한다.
3. **WebSocket 서버 구축**: SSE 이후 필요시 양방향 소통을 지원하는 WebSocket 서버를 구축하고 Redis Pub/Sub를 활용해 확장한다【22†L144-L149】.
4. **ISR 재도입**: 성능과 SEO를 위해 Incremental Static Regeneration(ISR)을 활용하여 일정 주기로 모니터링 스냅샷을 생성하고, 실시간 데이터는 클라이언트에서 업데이트한다.
5. **UI/UX 개선**: Skeleton UI 및 상태 변화 애니메이션을 도입해 로딩 경험을 개선하고, 모바일 환경에서 SSE에 따른 배터리 사용을 최적화한다.

### 장기 계획 (3개월 이상)

1. **마이크로서비스 전환**: 모니터링 기능을 별도 서비스로 분리하여 독립적으로 배포하고 확장할 수 있도록 한다.
2. **이상탐지 및 예측 모듈 개발**: 시계열 데이터를 활용해 모델 성능 예측이나 이상 탐지를 수행하는 데이터 분석 파이프라인을 구축한다.
3. **Chaos Engineering 테스트**: 정기적으로 장애 상황을 시뮬레이션하여 모니터링 시스템의 내고장성을 검증하고 개선한다.

## 우선순위 및 실행 계획

| 해결안 | 우선순위 | 기간 | 예상 효과 |
|---|---|---|---|
|운영 DB 연결 전환|높음|즉시|지속적인 데이터 저장 확보, 일관성 향상|
|모델-상태 초기화 로직|높음|즉시|모델 수 불일치 해소 및 누락 방지|
|Operational 기본값 제거|높음|즉시|장애 상황 표시 정확도 향상|
|SSR/SSG 비활성화 (CSR)|높음|즉시|최신 데이터 표시, 다국어 문제 해소|
|TimescaleDB 확장 및 복제|중간|1주 이내|시계열 성능 개선, 읽기 부하 분산|
|SSE 도입|중간|1–2주|실시간성 개선, 폴링 부하 감소|
|다국어 데이터 공유 개선|중간|1–2주|응답 지연 감소, 트래픽 절감|
|알림 시스템 구축|중간|1–2주|운영 인사이트 확보|
|글로벌 Read Replica|중간|1–3개월|지연 감소, 장애 대비 강화|
|헬스체크 수집기 개발|중간|1–3개월|상태 정확도 향상, 과거 추이 분석 가능|
|WebSocket 서버 구축|중간|1–3개월|양방향 실시간 통신 및 확장성 확보|
|ISR 재도입|중간|1–3개월|SEO 개선과 실시간성 조화|
|UI/UX 개선|중간|1–3개월|사용자 경험 향상|
|마이크로서비스 전환|낮음|3개월 이상|독립 확장성 증가, 유지보수 용이|
|이상탐지·예측 모듈|낮음|3개월 이상|고급 모니터링 제공|
|Chaos Engineering|낮음|3개월 이상|장애 내고장성 검증|

## 결론

현 모니터링 시스템은 서버리스 환경과 복잡한 데이터 파이프라인으로 인해 데이터 불일치, 실시간성 부족, 운영 DB 사용 제약 등의 문제가 발생하고 있다. 위의 단·중·장기 개선안을 순차적으로 적용하면 실시간성과 정확성을 보장하는 견고한 모니터링 플랫폼으로 발전할 수 있다.
