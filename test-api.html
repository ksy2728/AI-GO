<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API 테스트</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e293b;
            color: #f1f5f9;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        pre {
            background: #0f172a;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            border: 1px solid #334155;
        }
        .success {
            color: #10b981;
        }
        .error {
            color: #ef4444;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #2563eb;
        }
        h2 {
            color: #60a5fa;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔍 AI Server API 테스트</h1>
        
        <div>
            <button onclick="testAPI('models')">모델 API 테스트</button>
            <button onclick="testAPI('pricing')">가격 API 테스트</button>
            <button onclick="testAPI('status')">상태 API 테스트</button>
            <button onclick="testAPI('scheduler')">스케줄러 API 테스트</button>
        </div>
        
        <h2>API URL</h2>
        <pre id="apiUrl">대기 중...</pre>
        
        <h2>응답 상태</h2>
        <pre id="status">대기 중...</pre>
        
        <h2>응답 데이터</h2>
        <pre id="response">API를 테스트하려면 위 버튼을 클릭하세요.</pre>
        
        <h2>데이터 요약</h2>
        <pre id="summary">-</pre>
    </div>

    <script>
        const API_BASE = 'http://localhost:3006/api/v1';
        
        async function testAPI(endpoint) {
            const url = endpoint === 'models' || endpoint === 'pricing' 
                ? `${API_BASE}/${endpoint}?provider=openai`
                : `${API_BASE}/${endpoint}`;
            
            document.getElementById('apiUrl').textContent = url;
            document.getElementById('status').textContent = '요청 중...';
            document.getElementById('response').textContent = '로딩 중...';
            document.getElementById('summary').textContent = '분석 중...';
            
            const startTime = Date.now();
            
            try {
                console.log(`Fetching: ${url}`);
                const response = await fetch(url);
                const responseTime = Date.now() - startTime;
                
                const statusText = `✅ ${response.status} ${response.statusText} (${responseTime}ms)`;
                document.getElementById('status').textContent = statusText;
                document.getElementById('status').className = 'success';
                
                const data = await response.json();
                console.log('Response data:', data);
                
                // 데이터 표시
                document.getElementById('response').textContent = JSON.stringify(data, null, 2);
                
                // 요약 생성
                let summary = '';
                if (endpoint === 'models' && data.models) {
                    summary = `총 ${data.models.length}개 모델\n`;
                    summary += `캐시: ${data.cached ? '✅' : '❌'}\n`;
                    summary += `모델 목록:\n`;
                    data.models.forEach(m => {
                        summary += `  - ${m.name} (${m.slug})\n`;
                        summary += `    컨텍스트: ${m.contextWindow}, 가격: $${m.pricing?.inputPerMillion || 'N/A'}/1M\n`;
                    });
                } else if (endpoint === 'pricing' && data.pricing) {
                    summary = `총 ${data.pricing.length}개 가격 정보\n`;
                    data.pricing.forEach(p => {
                        summary += `  - ${p.model?.name || p.modelId}: $${p.inputPerMillion}/$${p.outputPerMillion}\n`;
                    });
                } else if (endpoint === 'status') {
                    summary = `총 모델: ${data.totalModels}\n`;
                    summary += `활성 모델: ${data.activeModels}\n`;
                    summary += `평균 가용성: ${data.avgAvailability}%\n`;
                } else if (endpoint === 'scheduler') {
                    summary = `스케줄러 상태: ${data.initialized ? '✅ 활성' : '❌ 비활성'}\n`;
                    if (data.tasks) {
                        summary += `작업 목록:\n`;
                        data.tasks.forEach(t => {
                            summary += `  - ${t.name}: ${t.isActive ? '✅' : '❌'} (${t.schedule})\n`;
                        });
                    }
                }
                
                document.getElementById('summary').textContent = summary || '데이터 요약 없음';
                
            } catch (error) {
                console.error('API Error:', error);
                document.getElementById('status').textContent = `❌ 오류: ${error.message}`;
                document.getElementById('status').className = 'error';
                document.getElementById('response').textContent = error.stack;
                document.getElementById('summary').textContent = '오류 발생';
            }
        }
        
        // 페이지 로드 시 모델 API 자동 테스트
        window.addEventListener('load', () => {
            setTimeout(() => testAPI('models'), 500);
        });
    </script>
</body>
</html>